#!/bin/sh

err() { printf "%s\n" "$@"; }

if [ "$1" = "-k" ]
then
	pgrep -f -- "ssh.*-L.*vm" | xargs kill
	exit
fi

err "I: Waiting for connectivity..."
while ! ssh -o ConnectTimeout=1 -o BatchMode=yes vm 2>&1 | grep "Permission denied" > /dev/null
do sleep 1
done


export SSH_ASKPASS="sshpass"
export SSH_ASKPASS_REQUIRE="prefer"
export PASSWORD="zot/qemu"

err "I: Activating vpn"
ssh vm "rasdial \"vpn.student.ehb.be\""
