#!/bin/sh

# dependencies
which pup > /dev/null ||
	exit 1

test -z "${query:=$1}" && 
	query="$(cat /dev/stdin)"

url="https://1337x.to"
query="$(echo "$query" | tr ' ' '+' )"
result="$(curl -s "$url/search/$query/1/" |
	pup -p 'a attr{href}' |
	grep "^/torrent" | 
	head -n 1)"
# result contains / as first char
curl -s "$url$result" |
	pup -p 'a attr{href}' |
	grep "^magnet:" |
	head -n 1
