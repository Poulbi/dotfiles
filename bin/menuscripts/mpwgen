#!/usr/bin/env sh

input () { commander -c -i -p "$1"; }

choice="$(printf "multiline\nsingle\n" | commander -c -w 2 -y 1)"
[ "$choice" ] || exit 1

password="$(input "name:")"
[ "$password" ] || exit 1

if [ "$choice" = "multiline" ]
then
	login="$(find "${PASSWORD_STORE_DIR:=$HOME/.password-store}"/e-mails \
        -type f \
        -maxdepth 1 \
        -iname "*.gpg" \
        -printf "%f\n" | sed 's/\.gpg$//' | commander -c -p 'login:')"
    [ "$login" ] || exit 1
    printf "%s\nlogin: %s\n" "${password}" "${login}" | pass insert -mf "${password}"
    pass generate -ci "${password}"
else
    pass generate -cf "${password}"
fi
